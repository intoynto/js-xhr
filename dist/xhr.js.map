{"version":3,"file":"xhr.js","mappings":"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","sources":["webpack://intoy-xhr/./src/ajax.ts","webpack://intoy-xhr/./src/createFormData.ts","webpack://intoy-xhr/./src/index.ts","webpack://intoy-xhr/./src/observe.ts","webpack://intoy-xhr/./src/serialize.ts","webpack://intoy-xhr/webpack/bootstrap","webpack://intoy-xhr/webpack/startup"],"sourcesContent":["/**\r\n * @author intoy\r\n * @email intoynto@gmail.com\r\n * @create date 2020-10-11 22:32:10\r\n * @modify date 2020-10-22 10:41:12\r\n * @desc XML Http Request\r\n */\n\nimport { getObserve } from \"./index\";\nimport { createFormData } from \"./createFormData\";\nimport { serialize } from \"./serialize\";\n\ninterface ILoose {\n  [key: string]: any;}\n\nexport type IUploadProgress = {\n  loaded: number;\n  total: number;\n  percentage: number;};\n\n\nexport interface Iajax extends ILoose {\n  url: string;\n  method?: string;\n  type?: string;\n  headers?: any;\n  params?: any;\n  formElement?: HTMLFormElement;\n  formData?: FormData;\n  responseType?: string;\n  onResolve?: (xhr: XMLHttpRequest) => void;\n  uploadProgress?: (props: IUploadProgress) => void;}\n\n\nexport interface IajaxException {\n  title: string;\n  status: number;\n  code: number;\n  statusText: string;\n  message: string;\n  description: string;\n  xhr: XMLHttpRequest;\n  [p: string]: any;}\n\n\n\ntype IrunAjaxResolveOptions = {\n  xhr: XMLHttpRequest;\n  formData: FormData;\n  handleToJson: boolean;};\n\n\ntype IrunAjaxResolve = (props: IrunAjaxResolveOptions) => void;\n\nfunction runAjax({ ...ops }: Iajax)\n{\n  return new Promise((resolve: IrunAjaxResolve, reject) => {\n    const mType = (ops.method ? ops.method : ops.type ? ops.type : \"GET\").toString().toUpperCase().trim();\n    const rspType = ops.responseType || \"json\"; //default response type of json\n\n    const dataParams = ops.params && typeof ops.params === \"object\" ? ops.params : ops.data && typeof ops.data === \"object\" ? ops.data : null;\n    const isDataParams = dataParams !== undefined && dataParams !== null;\n    const handleToJson = (rspType || \"\").toLowerCase().trim() === \"json\";\n\n    let sendF;\n    let toUrl = (ops.url || \"\").toString().trim();\n\n    if (ops.formElement)\n    {\n      sendF = new FormData(ops.formElement);\n\n      //remove empty upload\n      const inputs = ops.formElement.querySelectorAll('input[type=file]');\n      const removes = [];\n      if (inputs.length > 0)\n      {\n        for (let i = 0; i < inputs.length; i++)\n        {\n          const ii: HTMLInputElement = (inputs[i] as HTMLInputElement);\n          let file = ii.files && ii.files.length > 0 ? ii.files[0] : null;\n          if (!file)\n          {\n            removes.push(ii.name);\n          }\n        }\n      }\n      for (let i = 0; i < removes.length; i++)\n      {\n        ///remove upload empty\n        sendF.delete(removes[i]);\n      }\n    } else\n\n    if (ops.formData) {\n      sendF = ops.formData;\n    }\n\n    if (isDataParams) {\n      if (sendF) {\n        createFormData(dataParams, sendF);\n      } else\n      {\n        if (mType === \"GET\")\n        {\n          let ser = serialize(dataParams);\n          if (ser.length > 0) {\n            if (toUrl.indexOf(\"?\") < 0) {\n              toUrl += \"?\";\n            }\n            toUrl += ser;\n          }\n        } else\n        {\n          sendF = createFormData(dataParams);\n        }\n      }\n    }\n\n\n    const xhr = new XMLHttpRequest();\n\n    xhr.open(mType, toUrl);\n\n    if (ops.headers)\n    {\n      for (let p in ops.headers) {\n        xhr.setRequestHeader(p, ops.headers[p]);\n      }\n    }\n    if (handleToJson)\n    {\n      xhr.setRequestHeader('accept', 'application/json');\n    }\n\n    resolve({\n      xhr: xhr,\n      formData: (sendF as FormData),\n      handleToJson: handleToJson });\n\n  });\n}\n\nexport function ajax(ops: Iajax)\n{\n  const dispatchObserve = (xhr: XMLHttpRequest) => {\n    getObserve().listen(xhr);\n  };\n\n  return new Promise((resolve, reject) => {\n    runAjax(ops).\n    then((props: IrunAjaxResolveOptions) =>\n    {\n      const { handleToJson } = props;\n      const onLoadEnd = (ev: ProgressEvent<XMLHttpRequestEventTarget>) => {\n        const t: XMLHttpRequest = (ev.target as XMLHttpRequest);\n\n        const pe: IajaxException = {\n          title: 'Throw',\n          status: xhr.status,\n          code: xhr.status,\n          statusText: xhr.statusText,\n          message: xhr.statusText,\n          description: '',\n          xhr: xhr };\n\n\n        const berhasil = t.status === 200;\n        let isjson;\n        if (t.responseType.toString().toLowerCase() !== 'json') {\n          let ct = t.getResponseHeader('content-type');\n          ct = ct ? ct.toString().toLowerCase().trim() : '';\n          ct.split(';');\n          isjson = ct.indexOf('application/json') > 0;\n        }\n        if (!berhasil)\n        {\n          pe.title = 'Throw ' + xhr.status;\n          try {\n            const t = JSON.parse(xhr.responseText);\n            if (typeof t === 'object') {\n              const ce = Array.isArray(t.exception) ? t.exception[0] : null;\n              if (ce) {\n                pe.message = ce.message;\n                pe.description = ce.description ? ce.description : ce.message;\n              } else\n              {\n                pe.message = t.error && t.error.message ? t.error.message :\n                t.message ? t.message :\n                pe.message;\n\n                pe.description = t.error && t.error.description ? t.error.description :\n                t.description ? t.description :\n                pe.description;\n              }\n\n            }\n            dispatchObserve(t);\n            reject(pe);\n          }\n          catch (e) {\n            dispatchObserve(t);\n            reject(pe);\n          }\n          return;\n        }\n\n        if (handleToJson || isjson)\n        {\n          let str = (xhr.responseText || \"\").toString().trim();\n          if (str.length < 1)\n          {\n            pe.message = 'Tidak ada result dari server.';\n            dispatchObserve(t);\n            reject(pe);\n            return;\n          }\n\n          //try to json\n          try {\n            let data = JSON.parse(xhr.responseText);\n            dispatchObserve(t);\n            resolve(data);\n          }\n          catch (e: any)\n          {\n            pe.code = 409; //HTTP Conflict\n            pe.message = 'Parse error. ' + (e.message ? e.message : \"Unknown error.\");\n            dispatchObserve(t);\n            reject(pe);\n          }\n\n          return;\n        }\n        dispatchObserve(t);\n        resolve(xhr.response);\n      };\n\n      const onError = (ev: ProgressEvent<XMLHttpRequestEventTarget>) => {\n        const t: XMLHttpRequest = (ev.target as XMLHttpRequest);\n        dispatchObserve(t);\n        reject({ title: \"Throw\", message: \"Unknown error.\", xhr: t });\n      };\n\n      const { xhr, formData } = props;\n\n      // atach event\n      xhr.addEventListener(\"loadend\", onLoadEnd);\n      xhr.addEventListener(\"error\", onError);\n      if (typeof ops.uploadProgress === 'function')\n      {\n        const upProgres: (newProps: IUploadProgress) => void = ops.uploadProgress;\n        xhr.upload.addEventListener(\"progress\", function (ev: ProgressEvent<XMLHttpRequestEventTarget>) {\n          const { loaded, total } = ev;\n          const percentage = loaded / total * 100;\n          upProgres({ loaded, total, percentage });\n        });\n      }\n      // send data\n      xhr.send(formData);\n    }).\n    catch((e: any) => {\n      reject({ title: \"Throw\", message: e && e.message ? e.message : \"Unknown error.\" });\n    });\n  });\n}","export function createFormData(obj: any, formDataAppending?: FormData, namespace?: any) {\n  const formData = formDataAppending ? formDataAppending : new FormData();\n  for (let property in obj) {\n    const formKey = namespace ? `${namespace}[${property}]` : property;\n    if (obj[property] instanceof Date) {\n      formData.append(formKey, obj[property].toString());\n    } else\n    if (Array.isArray(obj[property]) && obj[property].length > 0) {\n      const args = obj[property];\n      for (let i = 0; i < args.length; i++) {\n        if (typeof args[i] === \"object\") {\n          createFormData(args[i], formData, `${formKey}[${i}]`);\n        } else\n        {\n          formData.append(`${formKey}[]`, args[i]);\n        }\n      }\n    } else\n    if (typeof obj[property] === \"object\" && !(obj[property] instanceof File))\n    {\n      createFormData(obj[property], formData, formKey);\n    } else\n    {\n      const val = obj[property];\n      if (val !== null && val !== undefined)\n      {\n        formData.append(formKey, val);\n      }\n    }\n  }\n  return formData;\n}","import { ajax } from \"./ajax\";\nimport { getObserve } from \"./observe\";\n\nexport { ajax, getObserve };\n\nexport type { Iajax } from \"./ajax\";","type Ilistener = (xhr: XMLHttpRequest) => void;\n\ninterface IObjserveAjax {\n  listen: (xhr: XMLHttpRequest) => void;\n  subscribe: (listener: Ilistener) => string;\n  unSubscribe: (key: string) => void;}\n\n\n\nclass ObserveAjax implements IObjserveAjax\n{\n  private listenerKeys: string[] = [];\n  private listenters: any;\n  constructor()\n  {\n    this.listenters = {};\n    this.subscribe = this.subscribe.bind(this);\n    this.unSubscribe = this.unSubscribe.bind(this);\n    this.listen = this.listen.bind(this);\n  }\n\n  subscribe(listener: Ilistener) {\n    const key: string = Math.random().toString(36);\n    this.listenters[key] = listener;\n    return key;\n  }\n\n  unSubscribe(key: string) {\n    const iof = this.listenerKeys.indexOf(key);\n    if (iof >= 0)\n    {\n      this.listenerKeys.splice(iof);\n      delete this.listenters[key];\n    }\n  }\n\n  listen(xhr: XMLHttpRequest)\n  {\n    for (let p in this.listenters)\n    {\n      const val = this.listenters[p];\n      if (typeof val === \"function\")\n      {\n        try {\n          val(xhr);\n        }\n        catch (e)\n        {\n\n        }\n      }\n    }\n  }}\n\n\n\nlet observe: IObjserveAjax | null = null;\n\nexport function getObserve(): IObjserveAjax\n{\n  if (!observe)\n  {\n    observe = new ObserveAjax();\n  }\n  return observe;\n}","export function serialize(obj?: any, key?: any, list?: any[]) {\n  list = list || [];\n  if (typeof obj === \"object\") {\n    for (let idx in obj) {\n      const val = obj[idx];\n      if (val !== null && val !== undefined) {\n        serialize(val, key ? key + '[' + idx + ']' : idx, list);\n      }\n    }\n  } else\n  {\n    list.push(key += '=' + encodeURIComponent(obj));\n  }\n  return list.join('&');\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(608);\n"],"names":["ops","dispatchObserve","xhr","getObserve","listen","Promise","resolve","reject","sendF","mType","method","type","toString","toUpperCase","trim","rspType","responseType","dataParams","params","data","isDataParams","handleToJson","toLowerCase","toUrl","url","formElement","FormData","inputs","querySelectorAll","removes","length","i","ii","files","push","name","formData","createFormData","ser","serialize","indexOf","XMLHttpRequest","open","headers","p","setRequestHeader","runAjax","then","props","addEventListener","ev","isjson","t","target","pe","title","status","code","statusText","message","description","berhasil","ct","getResponseHeader","split","responseText","JSON","parse","e","response","ce","Array","isArray","exception","error","uploadProgress","upload","loaded","total","percentage","send","obj","formDataAppending","namespace","property","formKey","Date","append","args","File","val","ajax","listenerKeys","this","listenters","subscribe","bind","unSubscribe","listener","key","Math","random","iof","splice","observe","ObserveAjax","list","idx","encodeURIComponent","join","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call"],"sourceRoot":""}